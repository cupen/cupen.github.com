<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="cupen<xcupen@gmail.com>">
  <meta name="description" content="Posts and writings by cupen<xcupen@gmail.com>">
  <title>
    吹水轩
&ndash; 给程序添加命令行接口（CLI）的一点体验  </title>

    <link rel="canonical" href="https://blog.dogame.cc/articles/2018-03-12/thinks-cli.html">

  <link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="https://blog.dogame.cc/theme/images/logo.png">

  <link rel="stylesheet" href="https://blog.dogame.cc/theme/css/style.min.css?3c592a94">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

<meta name="keywords" content="">
</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
<nav>
  <h1>Hi.</h1>
  <a href="https://blog.dogame.cc/">
    <img src="https://blog.dogame.cc/theme/images/logo.png" id="gravatar" alt="My photo"/>
  </a>
  <h2><a href="https://blog.dogame.cc/">I'm cupen<xcupen@gmail.com></a></h2>

  <div id="bio">
    <p></p>
  </div>

  <div id="social">
Connect with me:
<div id="stalker">

</div>  </div>

  <div id="tags">
    <ul>
      <li><a href="https://blog.dogame.cc/pages/about.html">关于</a></li>
      <li><a href="https://blog.dogame.cc/pages/duo-ming-qing-dan.html">夺命清单</a></li>
      <li><a href="http://evilbinary.org" target="_blank">鸭子<span style="font-size: 0.7em">&#8599;</span> </a></li>
      </ul>
  </div>
</nav>    </div>

    <div class="eleven columns content">
  <p class="meta">
    12 March 2018
    <a href="/">
      <i class="home fa fa-home"></i>
    </a>
  </p>

  <h1 class="title"><a href="https://blog.dogame.cc/articles/2018-03-12/thinks-cli.html">给程序添加命令行接口（CLI）的一点体验</a></h1>

  <div class="article_text" id="post">
    <p>程序实际运行时总会需要一些外部参数，一般情况下读取固定路径下的配置即可。但总有些参数需要灵活修改，以便让运维自由调整程序的运行姿势。普遍的做法是使用 <a href="https://en.wikipedia.org/wiki/Command-line_interface">CLI</a> (Command-line interface) ，开发和运维用了都说好，大家一口气上五楼。</p>
<p>用归用，但是否好用，不同的 CLI 实现风格是不太一样的。 
以下是我见过的几种</p>
<h2>Library</h2>
<p>普通的函数库。一般会提供【添加参数】、【添加子命令】这样的 api, 用于构造出 parser 来解析命令行参数。一般不提供【bind 到函数】之类的 api，需要人工编码处理。但其实做到这个份上已经足够了，剩下的事不是 parser 该做的。</p>
<ul>
<li>Python <a href="https://docs.python.org/3/library/argparse.html">argpase</a></li>
<li>C <a href="https://github.com/cofyc/argparse">argpase</a></li>
<li>C <a href="https://www.gnu.org/software/libc/manual/html_node/Example-of-Getopt.html#Example-of-Getopt">getopt</a></li>
</ul>
<h2>DSL</h2>
<p>非常酷，只需要用纯文本完整地写出 Help 文本（这个 DSL 语法就是 Help 内容），其通过解析该文本来生成 parser。非常直观，不依赖任何语言特性，于是在所有语言里都能实现出一致的体验，实际上也都实现了…… 但和 argparse 一样只是个 parser ，需要另外编码去调用具体的函数。</p>
<ul>
<li><a href="http://docopt.org/">docopt</a>  </li>
</ul>
<h2>元编程</h2>
<p>这一类的使用体验是最好的，只需实现函数本身，外加一点注释就能自动生成 parser 和函数 binding。 只是比较依赖语言的特性，至少也得有反射机制才行。比如 Python 连函数注释都能在运行时获得，于是就有了这个叫 [cbox] 的的项目。实现非常简单，我还给它加了子命令支持。</p>
<ul>
<li>Python <a href="https://github.com/shmuelamar/cbox">cbox</a></li>
<li>Python <a href="https://github.com/pallets/click">click</a></li>
<li>Java <a href="http://picocli.info/">picocli</a></li>
</ul>
<p>完。</p>
  </div>

  <div class="article_meta related">
    <h3>Category: </h3>
    <span><a href="https://blog.dogame.cc/category/articles.html">articles</span>

  </div>



      <div class="footer">
<div class="disclaimer">
  
    <p>
      © cupen<xcupen@gmail.com>,  &mdash; built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="https://github.com/karambir/taman" target="_blank">Taman</a>, a port of jekyll theme <a href="https://github.com/swanson/lagom" target="_blank">Lagom</a>.
    </p>
  </div>      </div>
    </div>
  </div>


</body>
</html>